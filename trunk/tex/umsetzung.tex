\section{Umsetzung}
In diesem Kapitel wird die Vorgehensweise der zuvor beschriebenen Problemstellungen erörtert.

\subsection{Aufbau der Testumgebung}

\input{tex/agents.tex}

\subsubsection{Aufsetzen eines Nagios-Test-Systems}
Da die einzelnen Überwachungselemente in der Überwachungssoftware Nagios nach und nach eingetragen (/ definiert / assoziiert / verbunden) werden müssen, ist ein häufiges Neustarten der Nagios-Anwendung notwendig, damit die neuen Konfigurationsdateien übernommen werden.

Damit dies nicht auf dem bereits verwendetem Nagios-Server durchgeführt werden muss, wird ein Nagios-Testserver für diesen Zweck eingesetzt.

Da Nagios ein Unix-ähnliches Betriebssystem erfordert, wird für diesen Zweck die Linux-Distribution Debian als Betriebssystem des Testservers verwendet.

\subsubsection{Bilddatenbank als virtuelle Maschine}
Für die Simulation der verschiedenen Fehlerzuständen der einzelnen Überwachungselemente wird eine virtuelle Maschine mit einer \gls{OracleUCM} Prototypinstallation, die extra als Entwicklungsplattform erstellt wurde, verwendet.



\subsection{Umsetzung der Systemüberwachung}

Die in Kapitel \ref{syschecks} aufgelisten Prozesse und Services können durch den NSClient-Dienst vom Nagios-Server überwacht werden.
Dafür wird der in Listing \ref{cus-nt-servdef} definierte verkürzte Befehl für \textit{check\_nt} benutzt.

\begin{lstlisting}[captionpos=b, caption=Prozess- und Service-Check Servicedefintionen, label=procservdef, breaklines = true, language=sh]
#Prozess des IIS Webservers
define service{
        use                     generic-service
        host_name               example.kit.edu
        service_description     IIS Prozess
        check_command           check_nt_example!PROCSTATE -l w3wp.exe
        }

#Zeitdienst
define service{
        use                     generic-service
        host_name               example.kit.edu
        service_description     Zeitdienst
        check_command           check_nt_example!SERVICESTATE -l W32TIME
        }
\end{lstlisting}

Mit diesen zwei Einträgen wird der Prozess des \gls{IIS}-Webservers und der Status des Dienstes zum Zeitabgleich überwacht.
Andere Prozesse und Dienste lassen sich nach dem gleichen Schema überwachen.

Nach einem Neustart von Nagios werden beide Einträge im Webinterface angezeigt:

\begin{figure}[ht]
	\centering
	   \fbox{\includegraphics[width=0.95\textwidth]{bilder/servproc.png}}
		\caption{Prozess- und Dienstüberwachung im Nagios-Webinterface}
		\label{servprocgui}
\end{figure}

Die Festplattenspeicherausnutzung und die Prozessorauslastung wird auf ähnliche Weise überwacht.
Hierbei muss beachtet werden, dass die Testergebnisse nicht eindeutig sind, im Gegensatz zu der Service- und Prozessüberwachung.
Wann Nagios alarmieren soll muss vom Anwender in Form von Parametern festgelegt werden.

\begin{lstlisting}[captionpos=b, caption=Überwachung der Festplatten- und Prozessorauslastung, label=cpuhdddef, breaklines = true, language=sh]
#Belegung der Partition C:
define service{
        use                     generic-service
        host_name               example.kit.edu
        service_description     C:\ Drive Space
        check_command           check_nt_example!USEDDISKSPACE -l c -w 85 -c 100
        }
        
#CPU Auslastung der letzten 5 Minuten
define service{
        use                     generic-service
        host_name               example.kit.edu
        service_description     CPU Load
        check_command           check_nt_example!CPULOAD -l 5,80,100
        }
\end{lstlisting}

Für diese Festplattenüberwachung versendet Nagios eine Warnung, wenn der belegte Speicherplatz auf der C-Partition die 85\% Marke überschreitet und meldet einen kritischen Fehler bei 100\%.
Bei der Prozessorüberwachung schlägt Nagios Alarm, wenn der Mittelwert der Auslastung in den letzten fünf Minuten mehr als 80\% bzw. 100\%  betragen hat.


\input{tex/funkttests.tex}

\subsection{Auswertung der Logdateien}

Um die drei genannten Logdateien aus Kapitel \ref{checklog} auszuwerten wird durch den \gls{NRPE}-Dienst das Plugin \textit{check\_logfiles} von Gerhard Laußer eingesetzt.

Dieses Plugin besitzt bereits einige nützliche Funktionen für die Überwachung von Logdateien.
Durch das Setzten eines Zeitstempels filter das Plugin veraltete Einträge heraus und untersucht nur neu hinzugekommene Zeilen.
Der Rotationsalgorithmus der Oracle UCM-Logdateien kann dem Plugin durch die Verwendung einer Konfigurationsdatei mitgeteilt werden.

Die Konfigurationsdatei für das \textit{check\_logfiles}-Plugin wird im folgendem Listing gezeigt:


\begin{lstlisting}[captionpos=b, caption=Konfigurationsdatei für \textit{check\_logfiles}, label=chklogcfg, breaklines = true, language=sh]
@searches = ({
  tag => 'ucmlogs',
  type => 'rotating::uniform',
  logfile => 'D:/bdb2/weblayout/groups/secure/logs/bdb/IdcLnLog.htm',
  rotation => 'refinery\d{2}\.htm',
  options => 'maxlength=623,nologfilenocry',
  warningpatterns => [
        'Cannot identify file',
	  'Bad CRC value in IHDR chunk',
	  'Der Dateiname darf nicht länger als 80 Zeichen sein',
    ],
});
\end{lstlisting}


\subsection{Benutzersimulation}





\begin{itemize}
\item \url{http://www.w3schools.com/soap/default.asp} Web Services und SOAP
\item \url{http://www.w3schools.com/wsdl/wsdl_summary.asp} WSDL
\item max attempts bei Search erhöhen, da Auslastung der InboundRef -> möglichst keine/geringe False Positives -> auf Ausblick verweisen, Rahmenbedingungen müssen im Feld in der Praxis erst noch gefunden werden
\end{itemize}ron

\begin{figure}[ht]
	\centering
	   \fbox{\includegraphics[width=0.93\textwidth]{bilder/wsdl.png}}
		\caption{Ablauf der Benutzersimulation}
		\label{usersim}
\end{figure}

\begin{figure}[ht]
	\centering
	   \fbox{\includegraphics[width=0.93\textwidth]{bilder/wsdl-valid.png}}
		\caption{Überprüfung der Benutzersimulation}
		\label{usersim2}
\end{figure}
%
\begin{figure}[ht]
	\centering
	   \includegraphics[width=0.9\textwidth]{bilder/Benutzersimulation.png}
		\caption{Ablauf der Benutzersimulation}
		\label{user-sim}
\end{figure}



